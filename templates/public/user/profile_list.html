{% extends 'base.html' %}

{% block title %}{{ user.get_full_name() or user.username }} - Album{% endblock %}



{% block content %}
<div class="min-h-screen bg-background">
    <!-- Header -->
    <div class="bg-card border-b border-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-foreground">Album</h1>
                    <p class="mt-2 text-muted-foreground">Album {{ user.get_full_name() or user.username }}</p>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="{{ url_for('user_profile.user_profile', username=user.username) }}" 
                       class="text-primary hover:text-foreground">
                        <i class="fas fa-arrow-left mr-2"></i>Kembali ke Profil
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Status Tabs and Create Button -->
        <div class="flex items-center justify-between border-b border-border mb-6">
            <nav class="flex space-x-8" aria-label="Album status tabs">
                <button id="published-tab" 
                        class="py-2 px-1 border-b-2 font-medium text-sm border-primary text-primary">
                    Dipublikasikan ({{ published_albums|length }})
                </button>
                <button id="draft-tab" 
                        class="py-2 px-1 border-b-2 font-medium text-sm border-transparent text-muted-foreground hover:text-foreground hover:border-border">
                    Draf ({{ draft_albums|length }})
                </button>
            </nav>
            
            {% if current_user.is_authenticated and current_user.id == user.id and has_write_access(user) %}
                <a href="{{ url_for('albums.create_album') }}" 
                   class="text-primary hover:text-foreground text-sm">
                    <i class="fas fa-plus mr-2"></i>Buat Album
                </a>
            {% endif %}
        </div>

        <!-- Published Albums -->
        <div id="published-content" class="space-y-6">
            {% if published_albums %}
                <div class="space-y-6">
                    {% for album in published_albums %}
                        <article class="bg-card rounded-lg shadow-sm border border-border overflow-hidden transition-all duration-300 hover:border-primary/30 hover:shadow-lg group">
                            <div class="flex flex-col sm:flex-row">
                                <!-- Image Container -->
                                <div class="sm:w-1/3 lg:w-2/5 xl:w-1/3 flex-shrink-0 bg-secondary overflow-hidden aspect-video sm:aspect-auto">
                                    <a href="{{ url_for('main.album_detail', album_id=album.id, album_title=album.title) }}" class="block h-full" aria-label="View album: {{ album.title | e }}">
                                        {% if album.cover_image %}
                                            <img src="{{ url_for('static', filename=album.cover_image.filepath.split('static/')[-1]) }}" 
                                                 alt="{{ album.title }}" 
                                                 class="w-full h-full object-cover object-center transition-transform duration-300 ease-in-out group-hover:scale-105" 
                                                 loading="lazy">
                                        {% else %}
                                            <div class="w-full h-full bg-muted flex items-center justify-center">
                                                <i class="fas fa-book text-4xl text-muted-foreground"></i>
                                            </div>
                                        {% endif %}
                                    </a>
                                </div>
                                <!-- Text Content Container -->
                                <div class="p-5 sm:p-6 flex flex-col justify-between flex-grow">
                                    <div>
                                        <!-- Title and Badges -->
                                        <div class="flex justify-between items-start mb-2 gap-x-2">
                                            <h3 class="text-lg font-semibold text-card-foreground leading-snug group-hover:text-primary transition-colors line-clamp-2">
                                                <a href="{{ url_for('main.album_detail', album_id=album.id, album_title=album.title) }}">{{ album.title }}</a>
                                            </h3>
                                            <div class="flex gap-1 mt-0.5 flex-shrink-0">
                                                <span class="bg-primary text-primary-foreground px-2 py-0.5 rounded text-xs font-semibold">Album</span>
                                                {% if album.is_premium %}
                                                    <span class="bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded text-xs font-semibold">Premium</span>
                                                {% endif %}
                                                {% if album.age_rating %}
                                                    <span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs font-semibold">{{ album.age_rating }}</span>
                                                {% endif %}
                                                {% if album.deletion_requested %}
                                                    <span class="bg-orange-100 text-orange-800 px-2 py-0.5 rounded text-xs font-semibold">
                                                        <i class="fas fa-clock mr-1"></i>Penghapusan Diminta
                                                    </span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <!-- Category Link -->
                                        {% if album.category %}
                                            <a href="{{ url_for('main.search', category=album.category.name) }}" class="text-xs font-medium text-primary mb-3 inline-block uppercase tracking-wider hover:underline">
                                                {{ album.category.name }}
                                            </a>
                                        {% endif %}
                                        <!-- Album Description -->
                                        {% if album.synopsis %}
                                            <p class="text-sm text-muted-foreground mb-4 line-clamp-3">{{ album.synopsis }}</p>
                                        {% endif %}
                                    </div>
                                    <!-- Meta Footer: Date, Views, Chapters -->
                                    <div class="mt-4 pt-3 border-t border-border text-xs text-muted-foreground flex flex-wrap items-center gap-x-3 gap-y-1">
                                        <span class="flex items-center gap-x-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3.5 h-3.5"><path fill-rule="evenodd" d="M4 1.75a.75.75 0 0 1 .75.75V3h6.5V2.5a.75.75 0 0 1 1.5 0V3h.5A1.75 1.75 0 0 1 15 4.75v8.5A1.75 1.75 0 0 1 13.25 15H2.75A1.75 1.75 0 0 1 1 13.25v-8.5A1.75 1.75 0 0 1 2.75 3H3.5V2.5a.75.75 0 0 1 4 1.75ZM2.5 7.75v5.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-5.5H2.5Zm11-3H2.5V4.75c0-.138.112-.25.25-.25h10.5a.25.25 0 0 1 .25.25V5Z" clip-rule="evenodd" /></svg>
                                            {{ album.created_at.strftime('%d %b %Y') if album.created_at }}
                                        </span>
                                        <span class="flex items-center gap-x-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3.5 h-3.5"><path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" /><path fill-rule="evenodd" d="M1.38 8.28a.87.87 0 0 1 0-.56C2.415 6.11 4.96 4 8 4s5.585 2.11 6.62 3.72a.87.87 0 0 1 0 .56C13.585 9.89 11.04 12 8 12s-5.585-2.11-6.62-3.72ZM8 10.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z" clip-rule="evenodd" /></svg>
                                            {{ album.total_views|default(0) }} views
                                        </span>
                                        <span class="flex items-center gap-x-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3.5 h-3.5"><path d="M8 1.75l1.5 3.5L13.5 5.5l-2.5 2.5.5 3.5L8 12.5l-3.5 1.5.5-3.5L2.5 5.5l3.5-.25L8 1.75z" /></svg>
                                            {{ album.total_chapters }} chapters
                                        </span>
                                    </div>
                                    
                                    {% if current_user.is_authenticated and current_user.id == user.id %}
                                        <div class="mt-3 flex space-x-2">
                                            <a href="{{ url_for('albums.edit_album', album_id=album.id) }}" 
                                               class="flex-1 bg-secondary text-secondary-foreground text-center py-2 px-3 rounded text-sm hover:bg-secondary/90 transition-colors">
                                                <i class="fas fa-edit mr-1"></i>Edit
                                            </a>
                                            {% if album.deletion_requested %}
                                                <button disabled class="flex-1 bg-gray-100 text-gray-400 text-center py-2 px-3 rounded text-sm cursor-not-allowed">
                                                    <i class="fas fa-clock mr-1"></i>Permintaan Tertunda
                                                </button>
                                            {% else %}
                                                <button onclick="requestAlbumDeletion({{ album.id }}, '{{ album.title | e }}')" 
                                                        class="flex-1 bg-orange-100 hover:bg-orange-200 text-orange-600 text-center py-2 px-3 rounded text-sm transition-colors">
                                                    <i class="fas fa-trash mr-1"></i>Minta Hapus
                                                </button>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </article>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12">
                    <i class="fas fa-book text-4xl text-muted-foreground mb-4"></i>
                    <h3 class="text-lg font-medium text-foreground mb-2">Tidak ada album yang dipublikasikan</h3>
                    <p class="text-muted-foreground mb-4">Pengguna ini belum memublikasikan album apapun.</p>
                    {% if current_user.is_authenticated and current_user.id == user.id %}
                        <a href="{{ url_for('albums.create_album') }}" 
                           class="bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Buat Album Pertama Anda
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <!-- Draft Albums -->
        <div id="draft-content" class="space-y-6 hidden">
            {% if draft_albums %}
                <div class="space-y-6">
                    {% for album in draft_albums %}
                        <article class="bg-card rounded-lg shadow-sm border border-border overflow-hidden transition-all duration-300 hover:border-primary/30 hover:shadow-lg group">
                            <div class="flex flex-col sm:flex-row">
                                <!-- Image Container -->
                                <div class="sm:w-1/3 lg:w-2/5 xl:w-1/3 flex-shrink-0 bg-secondary overflow-hidden aspect-video sm:aspect-auto">
                                    <div class="block h-full">
                                        {% if album.cover_image %}
                                            <img src="{{ url_for('static', filename=album.cover_image.filepath.split('static/')[-1]) }}" 
                                                 alt="{{ album.title }}" 
                                                 class="w-full h-full object-cover object-center transition-transform duration-300 ease-in-out group-hover:scale-105" 
                                                 loading="lazy">
                                        {% else %}
                                            <div class="w-full h-full bg-muted flex items-center justify-center">
                                                <i class="fas fa-book text-4xl text-muted-foreground"></i>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <!-- Text Content Container -->
                                <div class="p-5 sm:p-6 flex flex-col justify-between flex-grow">
                                    <div>
                                        <!-- Title and Badges -->
                                        <div class="flex justify-between items-start mb-2 gap-x-2">
                                            <h3 class="text-lg font-semibold text-card-foreground leading-snug line-clamp-2">
                                                {{ album.title }}
                                            </h3>
                                            <div class="flex gap-1 mt-0.5 flex-shrink-0">
                                                <span class="bg-gray-100 text-gray-800 px-2 py-0.5 rounded text-xs font-semibold">Draf</span>
                                                {% if album.is_premium %}
                                                    <span class="bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded text-xs font-semibold">Premium</span>
                                                {% endif %}
                                                {% if album.age_rating %}
                                                    <span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs font-semibold">{{ album.age_rating }}</span>
                                                {% endif %}
                                                {% if album.deletion_requested %}
                                                    <span class="bg-orange-100 text-orange-800 px-2 py-0.5 rounded text-xs font-semibold">
                                                        <i class="fas fa-clock mr-1"></i>Penghapusan Diminta
                                                    </span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <!-- Category Link -->
                                        {% if album.category %}
                                            <a href="{{ url_for('main.search', category=album.category.name) }}" class="text-xs font-medium text-primary mb-3 inline-block uppercase tracking-wider hover:underline">
                                                {{ album.category.name }}
                                            </a>
                                        {% endif %}
                                        <!-- Album Description -->
                                        {% if album.synopsis %}
                                            <p class="text-sm text-muted-foreground mb-4 line-clamp-3">{{ album.synopsis }}</p>
                                        {% endif %}
                                    </div>
                                    <!-- Meta Footer: Date, Views, Chapters -->
                                    <div class="mt-4 pt-3 border-t border-border text-xs text-muted-foreground flex flex-wrap items-center gap-x-3 gap-y-1">
                                        <span class="flex items-center gap-x-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3.5 h-3.5"><path fill-rule="evenodd" d="M4 1.75a.75.75 0 0 1 .75.75V3h6.5V2.5a.75.75 0 0 1 1.5 0V3h.5A1.75 1.75 0 0 1 15 4.75v8.5A1.75 1.75 0 0 1 13.25 15H2.75A1.75 1.75 0 0 1 1 13.25v-8.5A1.75 1.75 0 0 1 2.75 3H3.5V2.5a.75.75 0 0 1 4 1.75ZM2.5 7.75v5.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-5.5H2.5Zm11-3H2.5V4.75c0-.138.112-.25.25-.25h10.5a.25.25 0 0 1 .25.25V5Z" clip-rule="evenodd" /></svg>
                                            {{ album.created_at.strftime('%d %b %Y') if album.created_at }}
                                        </span>
                                        <span class="flex items-center gap-x-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3.5 h-3.5"><path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" /><path fill-rule="evenodd" d="M1.38 8.28a.87.87 0 0 1 0-.56C2.415 6.11 4.96 4 8 4s5.585 2.11 6.62 3.72a.87.87 0 0 1 0 .56C13.585 9.89 11.04 12 8 12s-5.585-2.11-6.62-3.72ZM8 10.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z" clip-rule="evenodd" /></svg>
                                            {{ album.total_views|default(0) }} views
                                        </span>
                                        <span class="flex items-center gap-x-1">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3.5 h-3.5"><path d="M8 1.75l1.5 3.5L13.5 5.5l-2.5 2.5.5 3.5L8 12.5l-3.5 1.5.5-3.5L2.5 5.5l3.5-.25L8 1.75z" /></svg>
                                            {{ album.total_chapters }} chapters
                                        </span>
                                    </div>
                                    
                                    {% if current_user.is_authenticated and current_user.id == user.id %}
                                        <div class="mt-3 flex space-x-2">
                                            <a href="{{ url_for('albums.edit_album', album_id=album.id) }}" 
                                               class="flex-1 bg-primary text-primary-foreground text-center py-2 px-3 rounded text-sm hover:bg-primary/90 transition-colors">
                                                <i class="fas fa-edit mr-1"></i>Edit
                                            </a>
                                            <button class="bg-green-500 text-white py-2 px-3 rounded text-sm hover:bg-green-600 transition-colors"
                                                    onclick="publishAlbum({{ album.id }})">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            {% if album.deletion_requested %}
                                                <button disabled class="flex-1 bg-gray-100 text-gray-400 text-center py-2 px-3 rounded text-sm cursor-not-allowed">
                                                    <i class="fas fa-clock mr-1"></i>Permintaan Tertunda
                                                </button>
                                            {% else %}
                                                <button onclick="requestAlbumDeletion({{ album.id }}, '{{ album.title | e }}')" 
                                                        class="flex-1 bg-orange-100 hover:bg-orange-200 text-orange-600 text-center py-2 px-3 rounded text-sm transition-colors">
                                                    <i class="fas fa-trash mr-1"></i>Minta Hapus
                                                </button>
                                            {% endif %}
                                        </div>
                                    {% else %}
                                        <div class="mt-3">
                                            <span class="flex-1 text-center py-2 px-3 rounded text-sm bg-muted text-muted-foreground block">
                                                Draf
                                            </span>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </article>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12">
                    <i class="fas fa-edit text-4xl text-muted-foreground mb-4"></i>
                    <h3 class="text-lg font-medium text-foreground mb-2">Tidak ada album draf</h3>
                    <p class="text-muted-foreground mb-4">Pengguna ini tidak memiliki album draf apapun.</p>
                    {% if current_user.is_authenticated and current_user.id == user.id %}
                        <a href="{{ url_for('albums.create_album') }}" 
                           class="bg-primary text-primary-foreground px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Buat Album Baru
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center p-4 z-50" role="dialog" aria-labelledby="delete-confirm-title" aria-modal="true">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
        <div class="p-6">
            <h3 id="delete-confirm-title" class="text-lg font-semibold text-gray-900 mb-4">Minta Penghapusan Album</h3>
            <p class="text-gray-700 mb-6">Apakah Anda yakin ingin meminta penghapusan "<span id="delete-album-title" class="font-semibold"></span>"?</p>
            <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 mb-4">
                <p class="text-sm text-orange-600"><i class="fas fa-info-circle mr-1"></i> Ini akan mengirimkan permintaan penghapusan untuk ditinjau oleh admin.</p>
            </div>
            <div class="flex justify-end space-x-3">
                <button onclick="closeDeleteConfirmModal()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors">
                    Batal
                </button>
                <button id="confirm-delete-btn" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                    Minta Penghapusan
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const publishedTab = document.getElementById('published-tab');
    const draftTab = document.getElementById('draft-tab');
    const publishedContent = document.getElementById('published-content');
    const draftContent = document.getElementById('draft-content');

    // Tab switching functionality
    publishedTab.addEventListener('click', function() {
        publishedTab.classList.add('border-primary', 'text-primary');
        publishedTab.classList.remove('border-transparent', 'text-muted-foreground');
        draftTab.classList.remove('border-primary', 'text-primary');
        draftTab.classList.add('border-transparent', 'text-muted-foreground');
        
        publishedContent.classList.remove('hidden');
        draftContent.classList.add('hidden');
    });

    draftTab.addEventListener('click', function() {
        draftTab.classList.add('border-primary', 'text-primary');
        draftTab.classList.remove('border-transparent', 'text-muted-foreground');
        publishedTab.classList.remove('border-primary', 'text-primary');
        publishedTab.classList.add('border-transparent', 'text-muted-foreground');
        
        draftContent.classList.remove('hidden');
        publishedContent.classList.add('hidden');
    });

    // Add escape key listener to close delete modal
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeDeleteConfirmModal();
        }
    });
    
    // Add click outside to close delete modal
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('fixed') && e.target.classList.contains('bg-black')) {
            closeDeleteConfirmModal();
        }
    });
});

// Global variables for delete functionality
let albumToDelete = null;

// Request album deletion - shows confirmation modal
function requestAlbumDeletion(albumId, albumTitle) {
    albumToDelete = albumId;
    document.getElementById('delete-album-title').textContent = albumTitle;
    document.getElementById('delete-confirm-modal').classList.remove('hidden');
    
    // Set up the confirm button
    const confirmBtn = document.getElementById('confirm-delete-btn');
    confirmBtn.onclick = function() {
        deleteAlbum(albumId);
    };
}

// Close delete confirmation modal
function closeDeleteConfirmModal() {
    document.getElementById('delete-confirm-modal').classList.add('hidden');
    albumToDelete = null;
}

// Delete album function - uses deletion request system
async function deleteAlbum(albumId) {
    try {
        const response = await fetch(`/api/albums/${albumId}/request-deletion`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'Failed to request album deletion');
            } else {
                throw new Error('Session expired. Please refresh the page and try again.');
            }
        }

        // Show success message
        showToast('Permintaan penghapusan album berhasil dikirim! Admin akan meninjau permintaan Anda.', 'success');
        closeDeleteConfirmModal();
        
        // Reload the page to refresh the album list
        window.location.reload();
        
    } catch (error) {
        console.error('Error requesting album deletion:', error);
        showToast(`Gagal meminta penghapusan album: ${error.message}`, 'error');
    }
}

// Simple toast notification function
function showToast(message, type = 'info') {
    // Remove existing toasts
    const existingToasts = document.querySelectorAll('.toast-notification');
    existingToasts.forEach(toast => toast.remove());
    
    const toast = document.createElement('div');
    toast.className = `toast-notification fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full`;
    
    let bgColor, textColor, icon;
    switch(type) {
        case 'success':
            bgColor = 'bg-green-500';
            textColor = 'text-white';
            icon = 'fas fa-check-circle';
            break;
        case 'error':
            bgColor = 'bg-red-500';
            textColor = 'text-white';
            icon = 'fas fa-exclamation-circle';
            break;
        case 'warning':
            bgColor = 'bg-yellow-500';
            textColor = 'text-white';
            icon = 'fas fa-exclamation-triangle';
            break;
        default:
            bgColor = 'bg-blue-500';
            textColor = 'text-white';
            icon = 'fas fa-info-circle';
    }
    
    toast.innerHTML = `
        <div class="flex items-center ${bgColor} ${textColor} p-3 rounded-lg">
            <i class="${icon} mr-3"></i>
            <span class="flex-1">${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" class="ml-3 text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Animate in
    setTimeout(() => {
        toast.classList.remove('translate-x-full');
    }, 100);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (toast.parentElement) {
            toast.classList.add('translate-x-full');
            setTimeout(() => toast.remove(), 300);
        }
    }, 5000);
}

function publishAlbum(albumId) {
    if (confirm('Apakah Anda yakin ingin memublikasikan album ini?')) {
        fetch(`/api/albums/${albumId}/visibility`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ is_visible: true })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error memublikasikan album: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error memublikasikan album');
        });
    }
}
</script>
{% endblock %}