{% extends 'base.html' %}

{% block title %}{{ brand_info.brand_name|default('LilyOpenCMS') }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index-albums.css') }}">
<script>window.__ADS_ALLOWED__ = true;</script>
{% endblock %}

{% block content %}
  <!-- Featured Albums Hero Section -->
  <section class="mb-12 lg:mb-16 relative w-full px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16">
    {% if featured_albums %}
      <div class="swiper featured-swiper aspect-video lg:aspect-[21/9] rounded-lg overflow-hidden bg-secondary shadow-sm border border-border">
        <div class="swiper-wrapper">
          {% for album in featured_albums[:3] %}
            <div class="swiper-slide group">
              <a href="{{ url_for('main.album_detail', album_id=album.id, album_title=safe_title(album.title)) }}" class="block w-full h-full relative">
                <img src="{{ album.cover_image.filepath if album.cover_image and album.cover_image.filepath else url_for('static', filename='pic/placeholder.png') }}"
                     alt="{{ album.title | e }}"
                     class="w-full h-full object-cover transition-transform duration-500 ease-in-out group-hover:scale-105"
                     onerror="this.onerror=null; this.src='{{ url_for('static', filename='pic/placeholder.png') }}';">
                
                <!-- Book Information Overlay -->
                <div class="absolute inset-x-0 bottom-0 h-2/3 bg-gradient-to-t from-black/80 via-black/60 to-transparent pointer-events-none"></div>
                <div class="absolute bottom-0 left-0 right-0 p-6 md:p-8 lg:p-10 text-white">
                  <div class="flex items-start justify-between gap-3">
                    <h3 class="text-xl md:text-2xl lg:text-3xl font-bold leading-tight group-hover:underline decoration-primary decoration-2 underline-offset-4 transition duration-200">
                      {{ album.title }}
                    </h3>
                    <div class="flex items-center gap-2 flex-shrink-0">
                      {% if album.is_premium %}
                        <span class="overlay-badge overlay-badge-premium">Premium</span>
                      {% endif %}
                      {% if album.age_rating %}
                        <span class="overlay-badge">{{ album.age_rating }}</span>
                      {% endif %}
                      <span class="overlay-badge {% if album.is_completed %}overlay-status-completed{% elif album.is_hiatus %}overlay-status-hiatus{% else %}overlay-status-ongoing{% endif %}">
                        {% if album.is_completed %}Selesai{% elif album.is_hiatus %}Hiatus{% else %}Ongoing{% endif %}
                      </span>
                    </div>
                  </div>
                  {% if album.description %}
                  <p class="text-sm md:text-base text-gray-100/95 mt-2 md:mt-3 mb-3 md:mb-4 line-clamp-2 md:line-clamp-3">
                    {{ album.description }}
                  </p>
                  {% endif %}
                  <div class="text-xs text-gray-200/90 flex flex-wrap items-center gap-x-3 gap-y-1">
                    <span class="flex items-center gap-x-1">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3 h-3 opacity-80"><path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM12.735 14c.618 0 1.093-.561.872-1.154a6.471 6.471 0 0 0-1.655-1.889A6.551 6.551 0 0 0 8 10c-1.83 0-3.53.772-4.743 2.036A6.47 6.47 0 0 0 1.6 12.846C1.38 13.439 1.855 14 2.473 14h10.262Z" /></svg>
                      {{ album.author if album.author else (album.owner.username if album.owner else 'Anonim') }}
                    </span>
                    <span class="hidden sm:inline">•</span>
                    <span class="flex items-center gap-x-1">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3 h-3 opacity-80"><path d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                      {{ album.total_views }} dilihat
                    </span>
                    <span class="hidden sm:inline">•</span>
                    <span class="flex items-center gap-x-1">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3 h-3 opacity-80"><path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" /><path fill-rule="evenodd" d="M1.38 8.28a.87.87 0 0 1 0-.56C2.415 6.11 4.96 4 8 4s5.585 2.11 6.62 3.72a.87.87 0 0 1 0 .56C13.585 9.89 11.04 12 8 12s-5.585-2.11-6.62-3.72ZM8 10.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z" clip-rule="evenodd" /></svg>
                      {{ album.total_reads }} reads
                    </span>
                    <span class="hidden sm:inline">•</span>
                    <span class="flex items-center gap-x-1">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3 h-3 opacity-80"><path d="M8 1.75l1.5 3.5L13.5 5.5l-2.5 2.5.5 3.5L8 12.5l-3.5 1.5.5-3.5L2.5 5.5l3.5-.25L8 1.75z" /></svg>
                      {{ album.total_chapters }} Bab
                    </span>
                  </div>
                </div>
              </a>
            </div>
          {% endfor %}
        </div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-pagination"></div>
      </div>
    {% else %}
      <div class="aspect-video lg:aspect-[21/9] rounded-lg bg-secondary border border-border flex items-center justify-center text-muted-foreground">
        <p>Belum ada album unggulan.</p>
      </div>
    {% endif %}
  </section>

  <!-- Popular Albums Section -->
  <section class="mb-12">
    <div class="container mx-auto px-4 sm:px-6 py-8 lg:py-12">
    <div class="flex justify-between items-center mb-6 border-b border-border pb-3">
      <h2 class="text-2xl lg:text-3xl font-semibold text-foreground flex items-center gap-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-primary/80"><path fill-rule="evenodd" d="M11.717 3.423c.213-.446.015-.984-.406-1.24a.75.75 0 0 1 0-.56C2.415 6.11 4.96 4 8 4s5.585 2.11 6.62 3.72a.75.75 0 0 1 0 .56C13.585 9.89 11.04 12 8 12s-5.585-2.11-6.62-3.72ZM8 10.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z" clip-rule="evenodd" /></svg>
        Terpopuler
      </h2>
      <a href="{{ url_for('main.albums_list') }}?sort=popular" class="text-sm font-semibold text-primary hover:underline">Lihat Semua →</a>
    </div>
    <div class="flex overflow-x-auto gap-6 px-4 py-4 scroll-smooth" data-ad-group="home-popular-albums">
      {% if popular_albums %}
        {% for album_item in popular_albums[:8] %}
          <article class="album-card bg-card rounded-lg border border-border overflow-hidden transition-all duration-300 hover:border-primary/30 hover:shadow-lg group flex-shrink-0 w-80 sm:w-88 lg:w-96">
            <a href="{{ url_for('main.album_detail', album_id=album_item.id, album_title=safe_title(album_item.title)) }}" class="block group">
              <div class="relative">
                {% set image_obj = album_item.cover_image %}
                {% set placeholder_img = url_for('static', filename='pic/placeholder.png') %}
                {% set final_img_url = placeholder_img %}
                {% if image_obj and image_obj.filepath %}
                  {% set image_filepath = image_obj.filepath %}
                  {% set path_without_static = image_filepath.replace('static/', '', 1) %}
                  {% set last_dot_index = path_without_static.rfind('.') %}
                  {% if last_dot_index != -1 %}
                    {% set base_path = path_without_static[:last_dot_index] %}
                    {% set extension = path_without_static[last_dot_index:] %}
                    {% set thumb_path = base_path ~ '_thumb_portrait' ~ extension %}
                    {% set final_img_url = url_for('static', filename=thumb_path) %}
                  {% endif %}
                {% endif %}
                <img src="{{ final_img_url }}"
                     alt="{{ album_item.title | e }}" 
                     class="album-cover w-full"
                     loading="lazy"
                     onerror="this.onerror=null; this.src='{{ placeholder_img }}';">
                
                <span class="chapter-count">{{ album_item.total_chapters }} Bab</span>
                <span class="status-badge {% if album_item.is_completed %}status-completed{% elif album_item.is_hiatus %}status-hiatus{% else %}status-ongoing{% endif %}">
                  {% if album_item.is_completed %}Selesai{% elif album_item.is_hiatus %}Hiatus{% else %}Ongoing{% endif %}
                </span>
                
                {% if album_item.is_premium %}
                  <span class="premium-badge">Premium</span>
                {% endif %}
                {% if album_item.age_rating %}
                  <span class="overlay-badge">{{ album_item.age_rating }}</span>
                {% endif %}
              </div>
              
              <div class="p-4">
                {% if album_item.category %}
                  <span class="inline-block mb-2 px-2 py-1 text-xs font-semibold rounded-full bg-primary/10 text-primary category-badge">{{ album_item.category.name }}</span>
                {% endif %}
                
                <h3 class="text-lg font-semibold text-card-foreground mb-2 line-clamp-2 group-hover:text-primary transition-colors album-title">
                  {{ album_item.title }}
                </h3>
                
                {% if album_item.description %}
                  <p class="text-sm text-muted-foreground line-clamp-3 mb-3 album-description">{{ album_item.description }}</p>
                {% endif %}
                
                {% if album_item.rating and album_item.rating.has_ratings %}
                  <div class="flex items-center mb-2">
                    <div class="flex items-center mr-2">
                      {% for i in range(1, 6) %}
                        {% if i <= album_item.rating.average|int %}
                          <i class="fas fa-star text-yellow-400"></i>
                        {% elif i == album_item.rating.average|int + 1 and album_item.rating.average % 1 >= 0.5 %}
                          <i class="fas fa-star-half-alt text-yellow-400"></i>
                        {% else %}
                          <i class="far fa-star text-gray-300"></i>
                        {% endif %}
                      {% endfor %}
                      <span class="ml-1 text-xs text-muted">({{ album_item.rating.count }})</span>
                    </div>
                    <span class="text-xs font-medium text-primary">{{ album_item.rating.average|round(1) }}</span>
                  </div>
                {% endif %}
                
                <div class="flex items-center justify-between text-xs text-muted-foreground">
                  <span>{{ album_item.created_at.strftime('%d %b %Y') if album_item.created_at else 'N/A' }}</span>
                  <span>{{ album_item.total_views }} dilihat • {{ album_item.total_reads }} baca</span>
                </div>
              </div>
            </a>
          </article>
        {% endfor %}
      {% else %}
        <div class="col-span-full text-center py-10 text-muted-foreground bg-card border border-border rounded-lg">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 mx-auto mb-4 text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.562.562 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" /></svg>
          <p class="font-semibold text-lg mb-1">Belum ada album populer.</p>
        </div>
      {% endif %}
    </div>
    </div> {# End Container #}
  </section>

  <!-- Newest Albums Section -->
  <section class="mb-12">
    <div class="container mx-auto px-4 sm:px-6 py-8 lg:py-12">
    <div class="flex justify-between items-center mb-6 border-b border-border pb-3">
      <h2 class="text-2xl lg:text-3xl font-semibold text-foreground flex items-center gap-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-primary/80"><path fill-rule="evenodd" d="M4.25 2A2.25 2.25 0 0 0 2 4.25v11.5A2.25 2.25 0 0 0 4.25 18h11.5A2.25 2.25 0 0 0 18 15.75V4.25A2.25 2.25 0 0 0 15.75 2H4.25ZM2.5 7.75v5.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-5.5H2.5Zm11-3H2.5V4.75c0-.138.112-.25.25-.25h10.5a.25.25 0 0 1 .25.25V5Z" clip-rule="evenodd" /></svg>
        Album Terbaru
      </h2>
      <a href="{{ url_for('main.albums_list') }}?sort=newest" class="text-sm font-semibold text-primary hover:underline">Lihat Semua →</a>
    </div>
    <div class="flex overflow-x-auto gap-6 px-4 py-4 scroll-smooth" data-ad-group="home-latest-albums">
      {% if latest_albums %}
        {% for album_item in latest_albums[:8] %}
          <article class="album-card-smaller bg-card rounded-lg border border-border overflow-hidden transition-all duration-300 hover:border-primary/30 hover:shadow-lg group flex-shrink-0 w-64 sm:w-72 lg:w-80">
            <a href="{{ url_for('main.album_detail', album_id=album_item.id, album_title=safe_title(album_item.title)) }}" class="block group">
              <div class="relative">
                {% set image_obj = album_item.cover_image %}
                {% set placeholder_img = url_for('static', filename='pic/placeholder.png') %}
                {% set final_img_url = placeholder_img %}
                {% if image_obj and image_obj.filepath %}
                  {% set image_filepath = image_obj.filepath %}
                  {% set path_without_static = image_filepath.replace('static/', '', 1) %}
                  {% set last_dot_index = path_without_static.rfind('.') %}
                  {% if last_dot_index != -1 %}
                    {% set base_path = path_without_static[:last_dot_index] %}
                    {% set extension = path_without_static[last_dot_index:] %}
                    {% set thumb_path = base_path ~ '_thumb_portrait' ~ extension %}
                    {% set final_img_url = url_for('static', filename=thumb_path) %}
                  {% endif %}
                {% endif %}
                <img src="{{ final_img_url }}"
                     alt="{{ album_item.title | e }}" 
                     class="album-cover w-full blur-[2px] scale-105"
                     loading="lazy"
                     onerror="this.onerror=null; this.src='{{ placeholder_img }}';">

                <span class="chapter-count">{{ album_item.total_chapters }} Bab</span>
                <span class="status-badge {% if album_item.is_completed %}status-completed{% elif album_item.is_hiatus %}status-hiatus{% else %}status-ongoing{% endif %}">
                  {% if album_item.is_completed %}Selesai{% elif album_item.is_hiatus %}Hiatus{% else %}Ongoing{% endif %}
                </span>
                {% if album_item.is_premium %}
                  <span class="premium-badge">Premium</span>
                {% endif %}
                {% if album_item.age_rating %}
                  <span class="overlay-badge">{{ album_item.age_rating }}</span>
                {% endif %}

                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/40 to-transparent"></div>
                <div class="absolute inset-0 p-4 flex flex-col justify-end text-white backdrop-blur-[2px]">
                  {% if album_item.category %}
                    <span class="inline-block mb-2 px-2 py-1 text-[10px] font-semibold rounded-full bg-primary/30 text-white border border-primary/40">{{ album_item.category.name }}</span>
                  {% endif %}
                  <h3 class="text-lg font-semibold mb-2 line-clamp-2">{{ album_item.title }}</h3>
                  {% if album_item.description %}
                  <p class="text-xs text-gray-200/90 line-clamp-2 mb-2">{{ album_item.description }}</p>
                  {% endif %}
                  {% if album_item.rating and album_item.rating.has_ratings %}
                    <div class="flex items-center mb-1 text-yellow-400">
                      <div class="flex items-center mr-2">
                        {% for i in range(1, 5) %}
                          {% if i <= album_item.rating.average|int %}
                            <i class="fas fa-star text-yellow-400"></i>
                          {% elif i == album_item.rating.average|int + 1 and album_item.rating.average % 1 >= 0.5 %}
                            <i class="fas fa-star-half-alt text-yellow-400"></i>
                          {% else %}
                            <i class="far fa-star text-gray-300"></i>
                          {% endif %}
                        {% endfor %}
                        <span class="ml-1 text-[11px] text-gray-200/90">({{ album_item.rating.count }})</span>
                      </div>
                      <span class="text-[11px] font-medium text-white/90">{{ album_item.rating.average|round(1) }}</span>
                    </div>
                  {% endif %}
                  <div class="flex items-center justify-between text-[11px] text-gray-200/90">
                    <span>{{ album_item.created_at.strftime('%d %b %Y') if album_item.created_at else 'N/A' }}</span>
                    <span>{{ album_item.total_reads }} baca</span>
                  </div>
                </div>
              </div>
            </a>
          </article>
        {% endfor %}
      {% else %}
        <div class="col-span-full text-center py-10 text-muted-foreground bg-card border border-border rounded-lg">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 mx-auto mb-4 text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.966 8.966 0 00-6 2.292m0-14.25v14.25" /></svg>
          <p class="font-semibold text-lg mb-1">Belum ada album terbaru.</p>
        </div>
      {% endif %}
    </div>
    </div> {# End Container #}
  </section>
  
  <!-- Best Albums Section -->
  <section class="mb-12">
    <div class="container mx-auto px-4 sm:px-6 py-8 lg:py-12">
    <div class="flex justify-between items-center mb-6 border-b border-border pb-3">
      <h2 class="text-2xl lg:text-3xl font-semibold text-foreground flex items-center gap-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-primary/80"><path fill-rule="evenodd" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.562.562 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" clip-rule="evenodd" /></svg>
        Best Albums
      </h2>
      <a href="{{ url_for('main.albums_list') }}?sort=highest-rated" class="text-sm font-semibold text-primary hover:underline">Lihat Semua →</a>
    </div>
    <div class="flex overflow-x-auto gap-6 px-4 py-4 scroll-smooth" data-ad-group="home-best-albums">
      {% if best_albums %}
        {% for album_item in best_albums[:8] %}
          <article class="album-card-smaller bg-card rounded-lg border border-border overflow-hidden transition-all duration-300 hover:border-primary/30 hover:shadow-lg group flex-shrink-0 w-64 sm:w-72 lg:w-80">
            <a href="{{ url_for('main.album_detail', album_id=album_item.id, album_title=safe_title(album_item.title)) }}" class="block group">
              <div class="relative">
                {% set image_obj = album_item.cover_image %}
                {% set placeholder_img = url_for('static', filename='pic/placeholder.png') %}
                {% set final_img_url = placeholder_img %}
                {% if image_obj and image_obj.filepath %}
                  {% set image_filepath = image_obj.filepath %}
                  {% set path_without_static = image_filepath.replace('static/', '', 1) %}
                  {% set last_dot_index = path_without_static.rfind('.') %}
                  {% if last_dot_index != -1 %}
                    {% set base_path = path_without_static[:last_dot_index] %}
                    {% set extension = path_without_static[last_dot_index:] %}
                    {% set thumb_path = base_path ~ '_thumb_portrait' ~ extension %}
                    {% set final_img_url = url_for('static', filename=thumb_path) %}
                  {% endif %}
                {% endif %}
                <img src="{{ final_img_url }}"
                     alt="{{ album_item.title | e }}" 
                     class="album-cover w-full blur-[2px] scale-105"
                     loading="lazy"
                     onerror="this.onerror=null; this.src='{{ placeholder_img }}';">

                <span class="chapter-count">{{ album_item.total_chapters }} Bab</span>
                <span class="status-badge {% if album_item.is_completed %}status-completed{% elif album_item.is_hiatus %}status-hiatus{% else %}status-ongoing{% endif %}">
                  {% if album_item.is_completed %}Selesai{% elif album_item.is_hiatus %}Hiatus{% else %}Ongoing{% endif %}
                </span>
                {% if album_item.is_premium %}
                  <span class="premium-badge">Premium</span>
                {% endif %}
                {% if album_item.age_rating %}
                  <span class="overlay-badge">{{ album_item.age_rating }}</span>
                {% endif %}
                {% if album_item.age_rating %}
                  <span class="age-badge">{{ album_item.age_rating }}</span>
                {% endif %}

                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/40 to-transparent"></div>
                <div class="absolute inset-0 p-4 flex flex-col justify-end text-white backdrop-blur-[2px]">
                  {% if album_item.category %}
                    <span class="inline-block mb-2 px-2 py-1 text-[10px] font-semibold rounded-full bg-primary/30 text-white border border-primary/40">{{ album_item.category.name }}</span>
                  {% endif %}
                  <h3 class="text-lg font-semibold mb-2 line-clamp-2">{{ album_item.title }}</h3>
                  {% if album_item.description %}
                  <p class="text-xs text-gray-200/90 line-clamp-2 mb-2">{{ album_item.description }}</p>
                  {% endif %}
                  {% if album_item.rating and album_item.rating.has_ratings %}
                    <div class="flex items-center mb-1 text-yellow-400">
                      <div class="flex items-center mr-2">
                        {% for i in range(1, 5) %}
                          {% if i <= album_item.rating.average|int %}
                            <i class="fas fa-star text-yellow-400"></i>
                          {% elif i == album_item.rating.average|int + 1 and album_item.rating.average % 1 >= 0.5 %}
                            <i class="fas fa-star-half-alt text-yellow-400"></i>
                          {% else %}
                            <i class="far fa-star text-gray-300"></i>
                          {% endif %}
                        {% endfor %}
                        <span class="ml-1 text-[11px] text-gray-200/90">({{ album_item.rating.count }})</span>
                      </div>
                      <span class="text-[11px] font-medium text-white/90">{{ album_item.rating.average|round(1) }}</span>
                    </div>
                  {% endif %}
                  <div class="flex items-center justify-between text-[11px] text-gray-200/90">
                    <span>{{ album_item.created_at.strftime('%d %b %Y') if album_item.created_at else 'N/A' }}</span>
                    <span>{{ album_item.total_reads }} baca</span>
                  </div>
                </div>
              </div>
            </a>
          </article>
        {% endfor %}
      {% else %}
        <div class="col-span-full text-center py-10 text-muted-foreground bg-card border border-border rounded-lg">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 mx-auto mb-4 text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.562.562 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" /></svg>
          <p class="font-semibold text-lg mb-1">Belum ada album terbaik.</p>
        </div>
      {% endif %}
    </div>
    </div> {# End Container #}
  </section>

  <!-- Ongoing Albums Section -->
  <section class="mb-12">
    <div class="container mx-auto px-4 sm:px-6 py-8 lg:py-12">
    <div class="flex justify-between items-center mb-6 border-b border-border pb-3">
      <h2 class="text-2xl lg:text-3xl font-semibold text-foreground flex items-center gap-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-primary/80"><path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z" clip-rule="evenodd" /></svg>
        Sedang Berlangsung
      </h2>
      <a href="{{ url_for('main.albums_list') }}?status=ongoing" class="text-sm font-semibold text-primary hover:underline">Lihat Semua →</a>
    </div>
    <div class="flex overflow-x-auto gap-6 px-4 py-4 scroll-smooth" data-ad-group="home-ongoing-albums">
      {% if ongoing_albums %}
        {% for album_item in ongoing_albums[:8] %}
          <article class="album-card-smaller bg-card rounded-lg border border-border overflow-hidden transition-all duration-300 hover:border-primary/30 hover:shadow-lg group flex-shrink-0 w-64 sm:w-72 lg:w-80">
            <a href="{{ url_for('main.album_detail', album_id=album_item.id, album_title=safe_title(album_item.title)) }}" class="block group">
              <div class="relative">
                {% set image_obj = album_item.cover_image %}
                {% set placeholder_img = url_for('static', filename='pic/placeholder.png') %}
                {% set final_img_url = placeholder_img %}
                {% if image_obj and image_obj.filepath %}
                  {% set image_filepath = image_obj.filepath %}
                  {% set path_without_static = image_filepath.replace('static/', '', 1) %}
                  {% set last_dot_index = path_without_static.rfind('.') %}
                  {% if last_dot_index != -1 %}
                    {% set base_path = path_without_static[:last_dot_index] %}
                    {% set extension = path_without_static[last_dot_index:] %}
                    {% set thumb_path = base_path ~ '_thumb_portrait' ~ extension %}
                    {% set final_img_url = url_for('static', filename=thumb_path) %}
                  {% endif %}
                {% endif %}
                <img src="{{ final_img_url }}"
                     alt="{{ album_item.title | e }}" 
                     class="album-cover w-full blur-[2px] scale-105"
                     loading="lazy"
                     onerror="this.onerror=null; this.src='{{ placeholder_img }}';">

                <span class="chapter-count">{{ album_item.total_chapters }} Bab</span>
                <span class="status-badge status-ongoing">Ongoing</span>
                {% if album_item.is_premium %}
                  <span class="premium-badge">Premium</span>
                {% endif %}

                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/40 to-transparent"></div>
                <div class="absolute inset-0 p-4 flex flex-col justify-end text-white backdrop-blur-[2px]">
                  {% if album_item.category %}
                    <span class="inline-block mb-2 px-2 py-1 text-[10px] font-semibold rounded-full bg-primary/30 text-white border border-primary/40">{{ album_item.category.name }}</span>
                  {% endif %}
                  <h3 class="text-lg font-semibold mb-2 line-clamp-2">{{ album_item.title }}</h3>
                  {% if album_item.description %}
                  <p class="text-xs text-gray-200/90 line-clamp-2 mb-2">{{ album_item.description }}</p>
                  {% endif %}
                  {% if album_item.rating and album_item.rating.has_ratings %}
                    <div class="flex items-center mb-1 text-yellow-400">
                      <div class="flex items-center mr-2">
                        {% for i in range(1, 5) %}
                          {% if i <= album_item.rating.average|int %}
                            <i class="fas fa-star text-yellow-400"></i>
                          {% elif i == album_item.rating.average|int + 1 and album_item.rating.average % 1 >= 0.5 %}
                            <i class="fas fa-star-half-alt text-yellow-400"></i>
                          {% else %}
                            <i class="far fa-star text-gray-300"></i>
                          {% endif %}
                        {% endfor %}
                        <span class="ml-1 text-[11px] text-gray-200/90">({{ album_item.rating.count }})</span>
                      </div>
                      <span class="text-[11px] font-medium text-white/90">{{ album_item.rating.average|round(1) }}</span>
                    </div>
                  {% endif %}
                  <div class="flex items-center justify-between text-[11px] text-gray-200/90">
                    <span>{{ album_item.created_at.strftime('%d %b %Y') if album_item.created_at else 'N/A' }}</span>
                    <span>{{ album_item.total_reads }} baca</span>
                  </div>
                </div>
              </div>
            </a>
          </article>
        {% endfor %}
      {% else %}
        <div class="col-span-full text-center py-10 text-muted-foreground bg-card border border-border rounded-lg">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 mx-auto mb-4 text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.966 8.966 0 00-6 2.292m0-14.25v14.25" /></svg>
          <p class="font-semibold text-lg mb-1">Belum ada album yang sedang berlangsung.</p>
        </div>
      {% endif %}
    </div>
    </div> {# End Container #}
  </section>

  <!-- Best Completed Albums Section -->
  <section class="mb-12">
    <div class="container mx-auto px-4 sm:px-6 py-8 lg:py-12">
    <div class="flex justify-between items-center mb-6 border-b border-border pb-3">
      <h2 class="text-2xl lg:text-3xl font-semibold text-foreground flex items-center gap-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-primary/80"><path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" /></svg>
        Best Completed
      </h2>
      <a href="{{ url_for('main.albums_list') }}?status=completed&sort=highest-rated" class="text-sm font-semibold text-primary hover:underline">Lihat Semua →</a>
    </div>
    <div class="flex overflow-x-auto gap-6 px-4 py-4 scroll-smooth" data-ad-group="home-completed-albums">
      {% if best_completed_albums %}
        {% for album_item in best_completed_albums[:8] %}
          <article class="album-card-smaller bg-card rounded-lg border border-border overflow-hidden transition-all duration-300 hover:border-primary/30 hover:shadow-lg group flex-shrink-0 w-64 sm:w-72 lg:w-80">
            <a href="{{ url_for('main.album_detail', album_id=album_item.id, album_title=safe_title(album_item.title)) }}" class="block group">
              <div class="relative">
                {% set image_obj = album_item.cover_image %}
                {% set placeholder_img = url_for('static', filename='pic/placeholder.png') %}
                {% set final_img_url = placeholder_img %}
                {% if image_obj and image_obj.filepath %}
                  {% set image_filepath = image_obj.filepath %}
                  {% set path_without_static = image_filepath.replace('static/', '', 1) %}
                  {% set last_dot_index = path_without_static.rfind('.') %}
                  {% if last_dot_index != -1 %}
                    {% set base_path = path_without_static[:last_dot_index] %}
                    {% set extension = path_without_static[last_dot_index:] %}
                    {% set thumb_path = base_path ~ '_thumb_portrait' ~ extension %}
                    {% set final_img_url = url_for('static', filename=thumb_path) %}
                  {% endif %}
                {% endif %}
                <img src="{{ final_img_url }}"
                     alt="{{ album_item.title | e }}" 
                     class="album-cover w-full blur-[2px] scale-105"
                     loading="lazy"
                     onerror="this.onerror=null; this.src='{{ placeholder_img }}';">

                <span class="chapter-count">{{ album_item.total_chapters }} Bab</span>
                <span class="status-badge status-completed">Selesai</span>
                {% if album_item.is_premium %}
                  <span class="premium-badge">Premium</span>
                {% endif %}

                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/40 to-transparent"></div>
                <div class="absolute inset-0 p-4 flex flex-col justify-end text-white backdrop-blur-[2px]">
                  {% if album_item.category %}
                    <span class="inline-block mb-2 px-2 py-1 text-[10px] font-semibold rounded-full bg-primary/30 text-white border border-primary/40">{{ album_item.category.name }}</span>
                  {% endif %}
                  <h3 class="text-lg font-semibold mb-2 line-clamp-2">{{ album_item.title }}</h3>
                  {% if album_item.description %}
                  <p class="text-xs text-gray-200/90 line-clamp-2 mb-2">{{ album_item.description }}</p>
                  {% endif %}
                  {% if album_item.rating and album_item.rating.has_ratings %}
                    <div class="flex items-center mb-1 text-yellow-400">
                      <div class="flex items-center mr-2">
                        {% for i in range(1, 5) %}
                          {% if i <= album_item.rating.average|int %}
                            <i class="fas fa-star text-yellow-400"></i>
                          {% elif i == album_item.rating.average|int + 1 and album_item.rating.average % 1 >= 0.5 %}
                            <i class="fas fa-star-half-alt text-yellow-400"></i>
                          {% else %}
                            <i class="far fa-star text-gray-300"></i>
                          {% endif %}
                        {% endfor %}
                        <span class="ml-1 text-[11px] text-gray-200/90">({{ album_item.rating.count }})</span>
                      </div>
                      <span class="text-[11px] font-medium text-white/90">{{ album_item.rating.average|round(1) }}</span>
                    </div>
                  {% endif %}
                  <div class="flex items-center justify-between text-[11px] text-gray-200/90">
                    <span>{{ album_item.created_at.strftime('%d %b %Y') if album_item.created_at else 'N/A' }}</span>
                    <span>{{ album_item.total_reads }} baca</span>
                  </div>
                </div>
              </div>
            </a>
          </article>
        {% endfor %}
      {% else %}
        <div class="col-span-full text-center py-10 text-muted-foreground bg-card border border-border rounded-lg">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 mx-auto mb-4 text-gray-400"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
          <p class="font-semibold text-lg mb-1">Belum ada album selesai terbaik.</p>
        </div>
      {% endif %}
    </div>
    </div> {# End Container #}
  </section>

  <!-- Categories Cards Section -->
  {% if categories and brand_info and brand_info.categories_display_location == 'body' %}
  <section class="mb-12">
    <div class="container mx-auto px-4 sm:px-6 py-8 lg:py-12">
    <div class="flex justify-between items-center mb-6 border-b border-border pb-3">
      <h2 class="text-2xl lg:text-3xl font-semibold text-foreground flex items-center gap-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-primary/80"><path fill-rule="evenodd" d="M4.25 2A2.25 2.25 0 0 0 2 4.25v11.5A2.25 2.25 0 0 0 4.25 18h11.5A2.25 2.25 0 0 0 18 15.75V4.25A2.25 2.25 0 0 0 15.75 2H4.25ZM2.5 7.75v5.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-5.5H2.5Zm11-3H2.5V4.75c0-.138.112-.25.25-.25h10.5a.25.25 0 0 1 .25.25V5Z" clip-rule="evenodd" /></svg>
        Kategori
      </h2>
    </div>
    <div class="flex overflow-x-auto gap-6 px-4 py-4 scroll-smooth">
      {% for category in categories %}
        <a href="{{ url_for('main.albums_list') }}?category={{ category.id }}" class="category-card group flex-shrink-0 w-32 sm:w-40 lg:w-48">
          <div class="bg-card rounded-xl border-2 border-border p-6 text-center hover:border-primary hover:shadow-xl transition-all duration-300 hover:scale-105">
            <div class="w-16 h-16 bg-primary/10 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:bg-primary/20 transition-all duration-300">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-8 h-8 text-primary"><path fill-rule="evenodd" d="M4.25 2A2.25 2.25 0 0 0 2 4.25v11.5A2.25 2.25 0 0 0 4.25 18h11.5A2.25 2.25 0 0 0 18 15.75V4.25A2.25 2.25 0 0 0 15.75 2H4.25ZM2.5 7.75v5.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-5.5H2.5Zm11-3H2.5V4.75c0-.138.112-.25.25-.25h10.5a.25.25 0 0 1 .25.25V5Z" clip-rule="evenodd" /></svg>
            </div>
            <h3 class="text-lg font-bold text-card-foreground group-hover:text-primary transition-colors duration-200 font-serif">{{ category.name }}</h3>
            <p class="text-sm text-muted-foreground mt-2 font-medium">{{ category.album_count }} Album</p>
          </div>
        </a>
              {% endfor %}
      </div>
    </div> {# End Container #}
  </section>
  {% endif %}

{% endblock %}

{% block extra_scripts %}
<script type="module" src="{{ url_for('static', filename='js/index.js') }}"></script>
{% endblock %} 