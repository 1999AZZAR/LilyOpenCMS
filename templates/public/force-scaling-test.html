{% extends "base.html" %}

{% block title %}Force Scaling Test - {{ brand_info.brand_name|default('LilyOpenCMS') }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-8">
    <!-- Header -->
    <div class="text-center">
        <h1 class="text-4xl font-bold text-foreground mb-4">Force Scaling Test</h1>
        <p class="text-lg text-muted-foreground mb-8">
            This page tests the force scaling functionality. Try changing your browser zoom level and see how the system responds.
        </p>
    </div>

    <!-- Current Scale Display -->
    <div class="bg-card border border-border rounded-lg p-6">
        <h2 class="text-2xl font-semibold text-foreground mb-4">Current Scale Information</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-background border border-border rounded-lg p-4">
                <h3 class="font-medium text-foreground mb-2">Detected Scale</h3>
                <p class="text-3xl font-bold text-primary" id="detected-scale">Loading...</p>
                <p class="text-sm text-muted-foreground">Browser/system zoom level</p>
            </div>
            <div class="bg-background border border-border rounded-lg p-4">
                <h3 class="font-medium text-foreground mb-2">Applied Scale</h3>
                <p class="text-3xl font-bold text-green-600" id="applied-scale">Loading...</p>
                <p class="text-sm text-muted-foreground">Scale applied to page</p>
            </div>
            <div class="bg-background border border-border rounded-lg p-4">
                <h3 class="font-medium text-foreground mb-2">Status</h3>
                <p class="text-3xl font-bold text-blue-600" id="scaling-status">Loading...</p>
                <p class="text-sm text-muted-foreground">Force scaling status</p>
            </div>
        </div>
    </div>

    <!-- Test Content -->
    <div class="bg-card border border-border rounded-lg p-6">
        <h2 class="text-2xl font-semibold text-foreground mb-4">Test Content</h2>
        <p class="text-base text-foreground mb-4">
            This content should remain properly sized regardless of browser zoom level. 
            The force scaling system will automatically adjust the page scaling to maintain 
            consistent appearance across different zoom levels.
        </p>
        
        <!-- Sample Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
            <div class="bg-background border border-border rounded-lg p-4">
                <h3 class="font-medium text-foreground mb-2">Card 1</h3>
                <p class="text-sm text-muted-foreground">This is a test card to demonstrate scaling behavior.</p>
            </div>
            <div class="bg-background border border-border rounded-lg p-4">
                <h3 class="font-medium text-foreground mb-2">Card 2</h3>
                <p class="text-sm text-muted-foreground">Another test card to show consistent sizing.</p>
            </div>
            <div class="bg-background border border-border rounded-lg p-4">
                <h3 class="font-medium text-foreground mb-2">Card 3</h3>
                <p class="text-sm text-muted-foreground">Third test card for demonstration purposes.</p>
            </div>
        </div>

        <!-- Sample Form -->
        <div class="bg-background border border-border rounded-lg p-4">
            <h3 class="font-medium text-foreground mb-4">Sample Form</h3>
            <form class="space-y-4">
                <div>
                    <label for="test-input" class="block text-sm font-medium text-foreground mb-2">Test Input</label>
                    <input type="text" id="test-input" class="w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter some text...">
                </div>
                <div>
                    <label for="test-select" class="block text-sm font-medium text-foreground mb-2">Test Select</label>
                    <select id="test-select" class="w-full px-3 py-2 border border-border rounded-md bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option>Option 1</option>
                        <option>Option 2</option>
                        <option>Option 3</option>
                    </select>
                </div>
                <button type="button" class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:opacity-90 transition-opacity">
                    Test Button
                </button>
            </form>
        </div>
    </div>

    <!-- Instructions -->
    <div class="bg-card border border-border rounded-lg p-6">
        <h2 class="text-2xl font-semibold text-foreground mb-4">How to Test</h2>
        <div class="space-y-4">
            <div class="flex items-start space-x-3">
                <div class="flex-shrink-0 w-6 h-6 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-medium">1</div>
                <div>
                    <h3 class="font-medium text-foreground">Change Browser Zoom</h3>
                    <p class="text-sm text-muted-foreground">Use Ctrl/Cmd + Plus to zoom in or Ctrl/Cmd + Minus to zoom out.</p>
                </div>
            </div>
            <div class="flex items-start space-x-3">
                <div class="flex-shrink-0 w-6 h-6 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-medium">2</div>
                <div>
                    <h3 class="font-medium text-foreground">Observe Changes</h3>
                    <p class="text-sm text-muted-foreground">Watch the scale information update and see how the content adjusts.</p>
                </div>
            </div>
            <div class="flex items-start space-x-3">
                <div class="flex-shrink-0 w-6 h-6 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-medium">3</div>
                <div>
                    <h3 class="font-medium text-foreground">Check Behavior</h3>
                    <p class="text-sm text-muted-foreground">If zoom is above 100%, the system should force it back to 100%. If zoom is 100% or less, it should remain unchanged.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug Information -->
    <div class="bg-card border border-border rounded-lg p-6">
        <h2 class="text-2xl font-semibold text-foreground mb-4">Debug Information</h2>
        <div class="bg-background border border-border rounded-lg p-4">
            <pre id="debug-info" class="text-sm text-foreground overflow-auto">Loading debug information...</pre>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Update scale information
    function updateScaleInfo() {
        const detectedScale = document.getElementById('detected-scale');
        const appliedScale = document.getElementById('applied-scale');
        const scalingStatus = document.getElementById('scaling-status');
        const debugInfo = document.getElementById('debug-info');
        
        if (window.forceScalingController) {
            const currentScale = window.forceScalingController.getCurrentScale();
            const isForced = window.forceScalingController.isScalingForced();
            
            detectedScale.textContent = (currentScale * 100).toFixed(0) + '%';
            appliedScale.textContent = isForced ? '100%' : (currentScale * 100).toFixed(0) + '%';
            scalingStatus.textContent = isForced ? 'Forced' : 'Normal';
            
            // Update debug info
            const debugData = {
                detectedScale: currentScale,
                isForced: isForced,
                userAgent: navigator.userAgent,
                viewport: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    devicePixelRatio: window.devicePixelRatio
                },
                visualViewport: window.visualViewport ? {
                    scale: window.visualViewport.scale,
                    width: window.visualViewport.width,
                    height: window.visualViewport.height
                } : 'Not supported'
            };
            
            debugInfo.textContent = JSON.stringify(debugData, null, 2);
        }
    }
    
    // Update scale info when scaling changes
    document.addEventListener('forceScalingChanged', updateScaleInfo);
    
    // Update scale info periodically
    setInterval(updateScaleInfo, 1000);
    
    // Initial update
    setTimeout(updateScaleInfo, 500);
</script>
{% endblock %}
