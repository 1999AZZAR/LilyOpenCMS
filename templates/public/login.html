{% extends 'base.html' %}

{% block title %}{{ brand_info.brand_name|default('LilyOpenCMS') }} - Login / Daftar{% endblock %}

{% block content %}
{# Use items-start to align card to the top within the flex container #}
<main class="container mx-auto px-4 sm:px-6 py-12 lg:py-20 flex justify-center items-start" role="main">
    {# Card Styling based on base.html theme #}
    <div class="bg-card border border-border p-6 sm:p-8 rounded-lg shadow-md w-full max-w-md" role="region" aria-label="Login and registration">

        {# --- Flash Messages for Errors/Success --- #}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="space-y-3 mb-6">
                {% for category, message in messages %}
                    {# Error Messages #}
                    {% if category == 'error' or category == 'danger' or category == 'login_error' or category == 'register_error' %}
                    <div class="p-4 rounded-md text-sm flex items-start gap-x-2 bg-red-100 border border-red-200 text-red-800" role="alert">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 flex-shrink-0"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L10 8.586 7.707 6.293a1 1 0 00-1.414 1.414L8.586 10l-2.293 2.293a1 1 0 001.414 1.414L10 11.414l2.293 2.293a1 1 0 001.414-1.414L11.414 10l2.293-2.293z" clip-rule="evenodd" /></svg>
                        <span>{{ message }}</span>
                    </div>
                    {# Success Messages (e.g., after registration) #}
                    {% elif category == 'success' %}
                    <div class="p-4 rounded-md text-sm flex items-start gap-x-2 bg-green-100 border border-green-200 text-green-800" role="alert">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 flex-shrink-0"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                        <span>{{ message }}</span>
                    </div>
                    {% endif %}
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        {# --- End Flash Messages --- #}

        <!-- Tabs -->
        <div class="flex mb-6 border-b border-border" role="tablist" aria-label="Login or register">
            {# Login Tab #}
            <button onclick="showTab('login')" 
                    id="loginTabButton"
                    role="tab"
                    aria-selected="true"
                    aria-controls="loginFormContainer"
                    tabindex="0"
                    class="flex-1 py-2 px-1 text-center text-sm font-medium transition-colors duration-200 border-b-2 text-primary border-primary">
                Login
            </button>
            {# Register Tab #}
            <button onclick="showTab('register')" 
                    id="registerTabButton"
                    role="tab"
                    aria-selected="false"
                    aria-controls="registerFormContainer"
                    tabindex="-1"
                    class="flex-1 py-2 px-1 text-center text-sm font-medium transition-colors duration-200 border-b-2 text-muted-foreground border-transparent hover:text-foreground">
                Daftar
            </button>
        </div>

        <!-- Login Form Container -->
        <div id="loginFormContainer" role="tabpanel" aria-labelledby="loginTabButton" tabindex="0">
            <h2 class="sr-only">Login Form</h2>
            <form method="POST" action="{{ url_for('main.login') }}" class="space-y-5" aria-label="Login form">
                {# Use standard CSRF token - works without WTForms #}
                <!-- CSRF protection disabled for this application -->
                <div>
                    <label for="login-username" class="block text-sm font-medium text-foreground mb-1.5">Username</label>
                    <input type="text" 
                           name="username" 
                           id="login-username"
                           class="block w-full h-10 px-3 bg-input border border-border rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring focus:border-primary transition-colors"
                           required 
                           minlength="3" 
                           autocomplete="username"
                           aria-required="true"
                           aria-describedby="login-username-help">
                    <p id="login-username-help" class="sr-only">Masukkan username Anda</p>
                </div>
                <div>
                    <label for="login-password" class="block text-sm font-medium text-foreground mb-1.5">Password</label>
                    <input type="password" 
                           name="password" 
                           id="login-password"
                           class="block w-full h-10 px-3 bg-input border border-border rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring focus:border-primary transition-colors"
                           required 
                           minlength="6" 
                           autocomplete="current-password"
                           aria-required="true"
                           aria-describedby="login-password-help">
                    <p id="login-password-help" class="sr-only">Masukkan password Anda</p>
                </div>
                <button type="submit"
                        class="button button-primary button-md w-full justify-center">
                    Login
                </button>
            </form>
        </div>

        <!-- Register Form Container -->
        <div id="registerFormContainer" 
             role="tabpanel" 
             aria-labelledby="registerTabButton" 
             class="hidden" 
             tabindex="0" 
             hidden>
            <h2 class="sr-only">Registration Form</h2>
            <form method="POST" action="{{ url_for('main.register') }}" class="space-y-5" aria-label="Registration form">
                 {# Use standard CSRF token #}
                <!-- CSRF protection disabled for this application -->
                <div>
                    <label for="register-username" class="block text-sm font-medium text-foreground mb-1.5">Username</label>
                    <input type="text" name="username" id="register-username"
                           class="block w-full h-10 px-3 bg-input border border-border rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring focus:border-primary transition-colors"
                           required minlength="3" autocomplete="username">
                    <p class="text-xs text-muted-foreground mt-1.5">Minimal 3 karakter.</p>
                </div>
                <div>
                    <label for="register-email" class="block text-sm font-medium text-foreground mb-1.5">Email</label>
                    <input type="email" name="email" id="register-email"
                           class="block w-full h-10 px-3 bg-input border border-border rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring focus:border-primary transition-colors"
                           required autocomplete="email">
                </div>
                <div>
                    <label for="register-password" class="block text-sm font-medium text-foreground mb-1.5">Password</label>
                    <input type="password" name="password" id="register-password"
                           class="block w-full h-10 px-3 bg-input border border-border rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring focus:border-primary transition-colors"
                           required minlength="6" autocomplete="new-password">
                    <p class="text-xs text-muted-foreground mt-1.5">Minimal 6 karakter.</p>
                </div>
                <div>
                    <label for="confirm-password" class="block text-sm font-medium text-foreground mb-1.5">Konfirmasi Password</label>
                    <input type="password" name="confirm_password" id="confirm-password"
                           class="block w-full h-10 px-3 bg-input border border-border rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring focus:border-primary transition-colors"
                           required autocomplete="new-password">
                </div>
                <div class="space-y-3 pt-2">
                    {# Use standard checkbox input and style the label #}
                    <div class="space-y-2">
                        <label class="text-xs text-muted-foreground flex items-start sm:items-center gap-x-2 cursor-pointer">
                            <input type="checkbox" 
                                   name="privacy_agreement" 
                                   required 
                                   class="h-4 w-4 mt-0.5 sm:mt-0 rounded border-border text-primary focus:ring-primary shrink-0">
                            <span class="inline-flex flex-wrap items-center gap-x-1">
                                Saya telah membaca dan menyetujui
                                <button type="button" 
                                        onclick="toggleModal('privacy')" 
                                        class="text-primary hover:underline font-medium">
                                    Kebijakan Privasi
                                </button>
                            </span>
                        </label>
                        <label class="text-xs text-muted-foreground flex items-start sm:items-center gap-x-2 cursor-pointer">
                            <input type="checkbox" 
                                   name="media_agreement" 
                                   required 
                                   class="h-4 w-4 mt-0.5 sm:mt-0 rounded border-border text-primary focus:ring-primary shrink-0">
                            <span class="inline-flex flex-wrap items-center gap-x-1">
                                Saya telah membaca dan menyetujui
                                <button type="button" 
                                        onclick="toggleModal('media')" 
                                        class="text-primary hover:underline font-medium">
                                    Pedoman Media Siber
                                </button>
                            </span>
                        </label>
                    </div>
                </div>
                <button type="submit"
                        class="button button-primary button-md w-full justify-center">
                    Daftar
                </button>
            </form>
        </div>
    </div>
</main>

{# --- Policy Modals (Using Macro for consistency) --- #}
{% macro policy_modal(modal_id, title_id, title_text, content_id) %}
<div id="{{ modal_id }}" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 transition-opacity duration-300 ease-in-out" aria-labelledby="{{ title_id }}" role="dialog" aria-modal="true">
    <div class="flex items-center justify-center min-h-screen p-4 text-center">
        <div class="bg-card text-card-foreground p-6 sm:p-8 rounded-lg w-full max-w-4xl relative max-h-[90vh] overflow-y-auto border border-border shadow-xl transform transition-all duration-300 ease-in-out scale-95 opacity-0 data-[state=open]:scale-100 data-[state=open]:opacity-100" data-state="closed">
            <button onclick="toggleModal('{{ modal_id.replace('Modal', '') }}')" class="absolute top-4 right-4 text-muted-foreground hover:text-primary transition-colors p-1 rounded-full hover:bg-secondary" aria-label="Tutup modal">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 id="{{ title_id }}" class="text-2xl sm:text-3xl font-bold text-primary mb-6 text-left">{{ title_text }}</h2>
            <div id="{{ content_id }}" class="space-y-5 text-left text-muted-foreground leading-relaxed">
                <!-- Loading State -->
                <div class="text-center py-10">
                    <div class="spinner mx-auto"></div>
                    <p class="mt-4 text-muted-foreground">Memuat konten...</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

{{ policy_modal('privacyModal', 'privacyModalTitle', 'Kebijakan Privasi', 'privacyContent') }}
{{ policy_modal('mediaModal', 'mediaModalTitle', 'Pedoman Media Siber', 'mediaContent') }}
{# --- End Modals --- #}

{% endblock %}

{% block extra_scripts %}
{# --- JAVASCRIPT FOR TABS AND MODALS --- #}
<script type="module" src="{{ url_for('static', filename='js/login.js') }}"></script>
{% endblock %}
