<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ brand_info.brand_name|default('LilyOpenCMS') }}{% endblock %}</title>
    <!-- CSRF protection disabled for this application -->

    <!-- Core Meta Tags -->
    <meta name="description" content="{% if seo_data.meta_description %}{{ seo_data.meta_description }}{% else %}{{ brand_info.tagline|default('Modern content management for the digital age') }}{% endif %}">
    <meta name="keywords" content="{% if seo_data.meta_keywords %}{{ seo_data.meta_keywords }}{% else %}{{ brand_info.brand_name|default('LilyOpenCMS') }}, berita, cerita, portal berita, jurnalisme{% endif %}">
    <meta name="author" content="{% if seo_data.meta_author %}{{ seo_data.meta_author }}{% else %}{{ brand_info.brand_name|default('LilyOpenCMS') }}{% endif %}">
    <meta name="language" content="{% if seo_data.meta_language %}{{ seo_data.meta_language }}{% else %}id{% endif %}">
    <meta name="robots" content="{% if seo_data.meta_robots %}{{ seo_data.meta_robots }}{% else %}index, follow{% endif %}">
    <link rel="canonical" href="{% if seo_data.canonical_url %}{{ seo_data.canonical_url }}{% else %}{{ request.url_root[:-1] }}{{ request.path }}{% endif %}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='pic/favicon.png') }}">

    <!-- Open Graph / Twitter -->
    <meta property="og:title" content="{% block og_title %}{% if seo_data.og_title %}{{ seo_data.og_title }}{% else %}{{ brand_info.brand_name|default('LilyOpenCMS') }}{% endif %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% if seo_data.og_description %}{{ seo_data.og_description }}{% else %}{{ brand_info.tagline|default('Modern content management for the digital age') }}{% endif %}{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{% if seo_data.og_image %}{{ seo_data.og_image }}{% else %}{{ url_for('static', filename='pic/dark.png', _external=True) }}{% endif %}{% endblock %}">
    <meta property="og:url" content="{% if seo_data.og_url %}{{ seo_data.og_url }}{% else %}{{ request.url }}{% endif %}">
    <meta property="og:type" content="{% if seo_data.og_type %}{{ seo_data.og_type }}{% else %}website{% endif %}">
    <meta property="og:site_name" content="{{ brand_info.brand_name|default('LilyOpenCMS') }}">
    <meta property="og:locale" content="id_ID">
    <meta name="twitter:card" content="{% if seo_data.twitter_card %}{{ seo_data.twitter_card }}{% else %}summary_large_image{% endif %}">
    <meta name="twitter:site" content="@LilyOpenCMS">
    <meta name="twitter:title" content="{% block twitter_title %}{% if seo_data.twitter_title %}{{ seo_data.twitter_title }}{% else %}{{ brand_info.brand_name|default('LilyOpenCMS') }}{% endif %}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}{% if seo_data.twitter_description %}{{ seo_data.twitter_description }}{% else %}{{ brand_info.tagline|default('Modern content management for the digital age') }}{% endif %}{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{% if seo_data.twitter_image %}{{ seo_data.twitter_image }}{% else %}{{ url_for('static', filename='pic/dark.png', _external=True) }}{% endif %}{% endblock %}">

    <!-- PWA & Mobile -->
    <meta name="theme-color" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="{{ brand_info.brand_name|default('LilyOpenCMS') }}">
    <meta name="application-name" content="{{ brand_info.brand_name|default('LilyOpenCMS') }}">
    <meta name="msapplication-TileColor" content="#ffffff">

    <!-- Structured Data (JSON-LD) -->
    {% if seo_data.schema_markup %}
    <script type="application/ld+json">
        {{ seo_data.schema_markup|safe }}
    </script>
    {% else %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "{{ brand_info.brand_name|default('LilyOpenCMS') }}",
        "description": "{{ brand_info.tagline|default('Modern content management for the digital age') }}",
        "url": "{{ request.url_root[:-1] }}{{ request.path }}",
        "inLanguage": "id"
    }
    </script>
    {% endif %}

    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    <link rel="preconnect" href="https://code.jquery.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

    <!-- Stylesheets -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <!-- Slick Carousel CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css" integrity="sha512-yHknP1/AwR+yx26cB1y0cjvQUMvEa2PFzt1c9LlS4pRQ5NOTZFWbhBig+X9G9eYW/8m0/4OXNx8pxJ6z57x0dw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base_css.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ads-injection.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive-optimization.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/force-scaling.css') }}">
    
    <!-- Navigation Layout Fixes -->
    <style>
        /* Ensure navigation links don't wrap and cause overlap */
        .nav-link {
            white-space: nowrap;
            font-size: 0.875rem;
            font-weight: 500;
            color: hsl(var(--muted-foreground));
            transition: color 0.2s ease;
        }
        
        .nav-link:hover {
            color: hsl(var(--primary));
        }
        
        /* Responsive navigation adjustments */
        @media (max-width: 1024px) {
            .nav-link {
                font-size: 0.8rem;
            }
        }
        
        @media (max-width: 768px) {
            /* Hide desktop navigation on mobile */
            .hidden.md\\:flex {
                display: none !important;
            }
        }
        
        /* Ensure proper spacing in admin layout */
        #main-content {
            min-height: calc(100vh - 200px);
        }
        
        /* Reduce footer spacing */
        footer {
            margin-top: auto;
        }
        
        /* Mobile categories toggle styling */
        #mobile-categories-toggle {
            user-select: none;
            cursor: pointer;
        }
        
        #mobile-categories-toggle:focus {
            outline: 2px solid hsl(var(--primary));
            outline-offset: 2px;
        }
        
        #mobile-categories-chevron {
            transition: transform 0.2s ease;
        }
        
        /* Smooth transition for categories content */
        #mobile-categories-content {
            transition: opacity 0.2s ease;
        }
        
        #mobile-categories-content.hidden {
            opacity: 0;
        }
        
        #mobile-categories-content:not(.hidden) {
            opacity: 1;
        }
    </style>
    <!-- Lazy Loading Script -->
    <script src="{{ url_for('static', filename='js/lazy-loading.js') }}" defer></script>
    
    <!-- Hide Scrollbars -->
    <style>
      /* Hide scrollbars for all elements */
      * {
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* Internet Explorer 10+ */
      }
      
      /* Webkit browsers (Chrome, Safari, Edge) */
      *::-webkit-scrollbar {
        display: none;
      }
      
      /* Ensure scrolling still works */
      html, body {
        scroll-behavior: smooth;
      }
      
      /* For specific elements that need scrolling but no scrollbar */
      .overflow-y-auto,
      .overflow-x-auto,
      .overflow-auto {
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      
      .overflow-y-auto::-webkit-scrollbar,
      .overflow-x-auto::-webkit-scrollbar,
      .overflow-auto::-webkit-scrollbar {
        display: none;
      }
    </style>

    <!-- Tailwind Config -->
    <script>
      // Default: disallow ads on pages unless explicitly enabled by the page template
      window.__ADS_ALLOWED__ = false;
      // Tailwind Config 
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              border: 'hsl(var(--border))', input: 'hsl(var(--input))', ring: 'hsl(var(--ring))',
              background: 'hsl(var(--background))', foreground: 'hsl(var(--foreground))',
              primary: { DEFAULT: 'hsl(var(--primary))', foreground: 'hsl(var(--primary-foreground))' },
              secondary: { DEFAULT: 'hsl(var(--secondary))', foreground: 'hsl(var(--secondary-foreground))' },
              destructive: { DEFAULT: 'hsl(var(--destructive))', foreground: 'hsl(var(--destructive-foreground))' },
              muted: { DEFAULT: 'hsl(var(--muted))', foreground: 'hsl(var(--muted-foreground))' },
              accent: { DEFAULT: 'hsl(var(--accent))', foreground: 'hsl(var(--accent-foreground))' },
              popover: { DEFAULT: 'hsl(var(--popover))', foreground: 'hsl(var(--popover-foreground))' },
              card: { DEFAULT: 'hsl(var(--card))', foreground: 'hsl(var(--card-foreground))' },
            },
            borderRadius: { lg: 'var(--radius)', md: 'calc(var(--radius) - 2px)', sm: 'calc(var(--radius) - 4px)' },
            fontSize: { base: ['15px', '1.6'] }
          },
        }, 
        plugins: [],
      }
    </script>

    {% block extra_head %}{% endblock %}
</head>
<body class="bg-background text-foreground antialiased flex flex-col min-h-screen"> {# Added antialiased and flex layout #}
    <!-- Loading Spinner - Unchanged -->
    <div id="loading-spinner" class="hidden"> <div class="spinner"></div> </div>

    <!-- Navigation -->
    <nav role="banner" aria-label="Main navigation" class="bg-card md:bg-card/85 backdrop-blur-lg shadow-sm sticky top-0 z-40 border-b border-border">
        <div class="w-full max-w-none px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16 py-3 flex items-center justify-between">
            <!-- Logo -->
            <a href="{{ url_for('main.home') }}"
               class="flex-shrink-0 inline-block focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary rounded"
               aria-label="LilyOpenCMS Homepage">
                  <img src="{{ url_for('static', filename='pic/logo.png') }}"
                       alt="LilyOpenCMS Logo"
                       class="h-10 w-auto">
            </a>
            <!-- End Logo -->

            <!-- Desktop Navigation - Flex-based layout to prevent overlap -->
            <div role="navigation" aria-label="Main navigation" class="hidden md:flex items-center space-x-4 lg:space-x-6 flex-1 justify-center max-w-lg mx-auto">
                {% for link in navbar_links %}
                <a href="{{ link.url }}" class="nav-link" {% if link.is_external %}target="_blank" rel="noopener noreferrer"{% endif %}>
                    {{ link.name }}
                </a>
                {% endfor %}
                
                <!-- Fallback links if no navigation links are configured -->
                {% if not navbar_links %}
                <a href="{{ url_for('main.utama') }}" class="nav-link">Utama</a>
                <a href="{{ url_for('main.news') }}" class="nav-link">Berita</a>
                <a href="{{ url_for('main.articles') }}" class="nav-link">Artikel</a>
                {% if latest_videos or (videos and videos.items) %}
                <a href="{{ url_for('main.videos') }}" class="nav-link">Video</a>
                {% endif %}
                {% if latest_images %}
                <a href="{{ url_for('main.gallery') }}" class="nav-link">Galeri</a>
                {% endif %}
                {% endif %}
            </div>

            <!-- Desktop Search + Actions -->
            <div role="toolbar" aria-label="User actions" class="hidden md:flex items-center space-x-4 lg:space-x-5 flex-shrink-0">
                {% set is_albums_site = (brand_info and brand_info.homepage_design == 'albums') %}
                
                <!-- Categories Dropdown (when enabled) - Beside Search -->
                {% if brand_info and brand_info.categories_display_location == 'navbar' %}
                <div class="relative group flex-shrink-0">
                    <button class="flex items-center gap-2 px-3 py-2 rounded-md bg-background border border-border hover:bg-accent hover:text-accent-foreground transition-colors text-sm" aria-haspopup="true" aria-expanded="false">
                        <i class="fa-solid fa-filter text-muted-foreground"></i>
                        <span class="hidden sm:inline">Kategori</span>
                        <span class="sm:hidden">Kat</span>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 transition-transform group-hover:rotate-180">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                        </svg>
                    </button>
                    <div class="absolute top-full left-0 mt-2 w-80 bg-card border border-border rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                        <div class="p-2 max-h-96 overflow-y-auto">
                            {% if grouped_categories %}
                                {% for group_data in grouped_categories %}
                                <div class="mb-3">
                                    <div class="px-3 py-2 text-xs font-semibold text-muted-foreground uppercase tracking-wide border-b border-border mb-2">
                                        {{ group_data.group.name }}
                                    </div>
                                    <div class="space-y-1">
                                        {% for category in group_data.categories %}
                                        <a href="{{ url_for('main.albums_list' if is_albums_site else 'main.news') }}?category={{ category.id }}" 
                                           class="block px-3 py-2 text-sm text-card-foreground hover:bg-accent hover:text-accent-foreground rounded-md transition-colors">
                                            {{ category.name }}
                                        </a>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                {% for category in all_categories %}
                                <a href="{{ url_for('main.albums_list' if is_albums_site else 'main.news') }}?category={{ category.id }}" 
                                   class="block px-3 py-2 text-sm text-card-foreground hover:bg-accent hover:text-accent-foreground rounded-md transition-colors">
                                    {{ category.name }}
                                </a>
                                {% endfor %}
                                {% if not all_categories %}
                                <div class="px-3 py-2 text-sm text-muted-foreground">
                                    Tidak ada kategori tersedia
                                </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <form action="{{ url_for('main.albums_list') if is_albums_site else url_for('main.news') }}" method="get" class="relative flex items-center flex-shrink-0">
                    <span class="absolute left-3 text-muted-foreground"><i class="fa-solid fa-magnifying-glass"></i></span>
                    <input
                        id="navbar-search-input"
                        name="q"
                        type="text"
                        autocomplete="off"
                        placeholder="{{ 'Cari album...' if is_albums_site else 'Cari berita...' }}"
                        class="w-40 sm:w-56 lg:w-72 pl-9 pr-16 py-2 rounded-md bg-background border border-border focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                    />
                    <button type="button" id="navbar-search-clear" title="Bersihkan" class="hidden absolute right-14 text-muted-foreground hover:text-foreground">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                    <button type="submit" class="ml-2 px-2 sm:px-3 py-2 rounded-md bg-primary text-primary-foreground hover:opacity-90 text-sm">
                        <span class="hidden sm:inline">Cari</span>
                        <span class="sm:hidden"><i class="fa-solid fa-magnifying-glass"></i></span>
                    </button>
                </form>
                {% if current_user.is_authenticated %}
                     <a href="{{ get_user_dashboard_url(current_user) }}" title="Pengaturan Akun" class="text-muted-foreground hover:text-primary transition-colors p-1.5 rounded-full hover:bg-accent"> 
                        <i class="fa-solid fa-circle-user fa-fw text-xl"></i>
                     </a>
                     <a href="{{ url_for('main.logout') }}" title="Keluar" class="text-muted-foreground hover:text-primary transition-colors p-1.5 rounded-full hover:bg-accent"> 
                        <i class="fa-solid fa-arrow-right-from-bracket fa-fw text-xl"></i>
                     </a>
                {% endif %}
            </div>

            <!-- Mobile: Menu Button -->
            <div class="md:hidden flex items-center space-x-2">
                <button id="mobile-menu-button" title="Buka Menu Navigasi" class="text-muted-foreground hover:text-primary transition-colors p-2 rounded-md hover:bg-accent">
                   <i class="fa-solid fa-bars fa-fw text-xl"></i>
                </button>
            </div>
        </div>



    </nav> <!-- End of Nav -->

    <!-- Ad Placement Area - Header/Top (REMOVED: Avoids navigation areas) -->
    <!-- <div id="ad-header-top" class="ad-placement-area" data-ad-section="header" data-ad-position="top"></div> -->

    <!-- Main Content Area -->
    <main class="w-full max-w-none px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16 pt-6 pb-12 lg:pt-8 lg:pb-16 flex-1">
         {# --- Flash Messages (Improved Styling) --- #}
         {% with messages = get_flashed_messages(with_categories=true) %}
             {% if messages %}
                 <div class="space-y-4 mb-6"> {# Increased spacing #}
                 {% for category, message in messages %}
                     <div class="p-4 rounded-lg shadow-sm flex items-start gap-x-4 border-l-4
                         {% if category == 'error' %} bg-red-50 border-red-400 text-red-800
                         {% elif category == 'success' %} bg-green-50 border-green-400 text-green-800
                         {% else %} bg-blue-50 border-blue-400 text-blue-800 {% endif %}"
                          role="alert">
                         <span class="flex-shrink-0 mt-0.5">
                             {% if category == 'error' %}
                                <i class="fa-solid fa-circle-exclamation fa-fw text-lg text-red-500"></i> {# Increased size #}
                             {% elif category == 'success' %}
                                <i class="fa-solid fa-circle-check fa-fw text-lg text-green-500"></i> {# Increased size #}
                             {% else %}
                                <i class="fa-solid fa-circle-info fa-fw text-lg text-blue-500"></i> {# Increased size #}
                             {% endif %}
                         </span>
                         <span class="text-sm leading-relaxed">{{ message }}</span> {# Adjusted leading #}
                         {# Optional: Add a close button
                         <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-transparent rounded-lg focus:ring-2 p-1.5 inline-flex h-8 w-8"
                                 {% if category == 'error' %} data-dismiss-target="#alert-error" aria-label="Close" class="hover:bg-red-100 focus:ring-red-400"
                                 {% elif category == 'success' %} data-dismiss-target="#alert-success" aria-label="Close" class="hover:bg-green-100 focus:ring-green-400"
                                 {% else %} data-dismiss-target="#alert-info" aria-label="Close" class="hover:bg-blue-100 focus:ring-blue-400" {% endif %}>
                             <span class="sr-only">Dismiss</span>
                             <i class="fa-solid fa-xmark fa-fw"></i>
                         </button>
                         #}
                     </div>
                 {% endfor %}
                 </div>
             {% endif %}
         {% endwith %}
         {# --- End Flash Messages --- #}

        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% include 'footer.html' %}
    <!-- End Footer -->

    <!-- Mobile Menu Overlay (Removed, integrated into menu) -->
    <!-- <div id="mobile-menu-overlay" class="fixed inset-0 bg-black opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out z-40 md:hidden"></div> -->

    <!-- Full Screen Mobile Navigation Menu -->
    {# MODIFIED: Changed classes for full screen, opacity transition, added close button #}
    {# ADDED: -translate-y-4 for initial slide-up, transition-all to include transform #}
    <div id="mobile-menu" class="fixed inset-0 w-full h-screen bg-card backdrop-blur-sm p-6 opacity-0 pointer-events-none -translate-y-4 transition-all duration-300 ease-in-out z-50 md:hidden flex flex-col">
        <!-- Close Button -->
        <button id="mobile-menu-close-button" class="absolute top-4 right-4 text-muted-foreground hover:text-primary transition-colors p-2 rounded-full hover:bg-accent z-50" title="Tutup Menu">
            <i class="fa-solid fa-xmark fa-fw text-2xl"></i>
        </button>

        {# Added max-h-screen and overflow-y-auto for long menus #}
        {# MODIFIED: Added flex flex-col justify-between to distribute content vertically #}
        <div class="p-6 pt-14 h-full overflow-y-auto flex flex-col justify-between">
            {# Mobile navbar search #}
            {% set is_albums_site = (brand_info and brand_info.homepage_design == 'albums') %}
            <form action="{{ url_for('main.albums_list') if is_albums_site else url_for('main.news') }}" method="get" class="mb-6">
                <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"><i class="fa-solid fa-magnifying-glass"></i></span>
                    <input id="mobile-navbar-search-input" name="q" type="text" autocomplete="off"
                           placeholder="{{ 'Cari album...' if is_albums_site else 'Cari berita...' }}"
                           class="w-full pl-9 pr-16 py-2 rounded-md bg-background border border-border focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" />
                    <button type="button" id="mobile-navbar-search-clear" title="Bersihkan" class="hidden absolute right-14 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                    <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1.5 rounded-md bg-primary text-primary-foreground text-sm">Cari</button>
                </div>
            </form>
            
            <!-- Categories Section (when enabled) - Collapsible on Mobile -->
            {% if brand_info and brand_info.categories_display_location == 'navbar' %}
            <div class="mb-6">
                <button id="mobile-categories-toggle" class="w-full flex items-center justify-between px-3 py-2 rounded-md bg-background border border-border text-sm hover:bg-accent transition-colors">
                    <div class="flex items-center gap-2">
                        <i class="fa-solid fa-filter text-muted-foreground"></i>
                        <span class="font-medium">Kategori</span>
                    </div>
                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-200" id="mobile-categories-chevron"></i>
                </button>
                <div id="mobile-categories-content" class="mt-2 space-y-3 hidden">
                    {% if grouped_categories %}
                        {% for group_data in grouped_categories %}
                        <div class="space-y-1">
                            <div class="px-3 py-1 text-xs font-semibold text-muted-foreground uppercase tracking-wide">
                                {{ group_data.group.name }}
                            </div>
                            {% for category in group_data.categories %}
                            <a href="{{ url_for('main.albums_list' if is_albums_site else 'main.news') }}?category={{ category.id }}" 
                               class="mobile-nav-link flex items-center gap-3 text-base py-2 px-3 rounded-md hover:bg-accent">
                                <i class="fa-solid fa-chevron-right text-xs"></i>
                                <span>{{ category.name }}</span>
                            </a>
                            {% endfor %}
                        </div>
                        {% endfor %}
                    {% else %}
                        {% for category in all_categories %}
                        <a href="{{ url_for('main.albums_list' if is_albums_site else 'main.news') }}?category={{ category.id }}" 
                           class="mobile-nav-link flex items-center gap-3 text-base py-2 px-3 rounded-md hover:bg-accent">
                            <i class="fa-solid fa-chevron-right text-xs"></i>
                            <span>{{ category.name }}</span>
                        </a>
                        {% endfor %}
                        {% if not all_categories %}
                        <div class="text-sm text-muted-foreground px-3 py-2">
                            Tidak ada kategori tersedia
                        </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            {% endif %}
            <ul class="list-none p-0 m-0 space-y-6"> {# Further Increased spacing #}
                <li>
                    <a href="{{ url_for('main.home') }}" class="mobile-nav-link flex items-center gap-3 text-lg py-3 px-3 rounded-md hover:bg-accent">
                       <i class="fa-solid fa-house"></i>
                       <span>Beranda</span>
                    </a>
                </li>
                {% for link in navbar_links %}
                <li>
                    <a href="{{ link.url }}" class="mobile-nav-link flex items-center gap-3 text-lg py-3 px-3 rounded-md hover:bg-accent" {% if link.is_external %}target="_blank" rel="noopener noreferrer"{% endif %}>
                        <i class="fa-solid fa-link"></i>
                        <span>{{ link.name }}</span>
                    </a>
                </li>
                {% endfor %}
                
                <!-- Fallback links if no navigation links are configured -->
                {% if not navbar_links %}
                <li>
                    <a href="{{ url_for('main.utama') }}" class="mobile-nav-link flex items-center gap-3 text-lg py-3 px-3 rounded-md hover:bg-accent">
                        <i class="fa-solid fa-newspaper"></i>
                        <span>Utama</span>
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('main.news') }}" class="mobile-nav-link flex items-center gap-3 text-lg py-3 px-3 rounded-md hover:bg-accent">
                        <i class="fa-regular fa-newspaper"></i>
                        <span>Berita</span>
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('main.articles') }}" class="mobile-nav-link flex items-center gap-3 text-lg py-3 px-3 rounded-md hover:bg-accent">
                        <i class="fa-solid fa-book-open"></i>
                        <span>Artikel</span>
                    </a>
                </li>
                {% if latest_videos or (videos and videos.items) %}
                <li>
                    <a href="{{ url_for('main.videos') }}" class="mobile-nav-link flex items-center gap-3 text-lg py-3 px-3 rounded-md hover:bg-accent">
                        <i class="fa-solid fa-play"></i>
                        <span>Video</span>
                    </a>
                </li>
                {% endif %}
                {% if latest_images %}
                <li>
                    <a href="{{ url_for('main.gallery') }}" class="mobile-nav-link flex items-center gap-3 text-lg py-3 px-3 rounded-md hover:bg-accent">
                        <i class="fa-solid fa-images"></i>
                        <span>Galeri</span>
                    </a>
                </li>
                {% endif %}
                {% endif %}
            </ul>

           {# Divider and Account Links #}
            <div class="border-t border-border pt-6 mt-6"> {# Increased padding/margin #}
                 {% if current_user.is_authenticated %}
                    <ul class="list-none p-0 m-0 space-y-6"> {# Further Increased spacing #}
                        <li> {# Account/Logout links keep the same spacing as main menu #}
                            <a href="{{ get_user_dashboard_url(current_user) }}" class="mobile-nav-link flex items-center gap-3 text-lg py-3 px-3 rounded-md hover:bg-accent">
                                <i class="fa-solid fa-circle-user"></i>
                                <span>Akun Saya</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('main.logout') }}" class="mobile-nav-link text-destructive flex items-center gap-3 text-lg py-3 px-3 rounded-md hover:bg-accent">
                                <i class="fa-solid fa-arrow-right-from-bracket"></i>
                                <span>Logout</span>
                            </a>
                        </li>
                    </ul>
                 {% endif %}
            </div>
        </div>
    </div>

    <!-- Core Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <!-- Custom Application Scripts -->
    <script src="{{ url_for('static', filename='js/mobile-toggler.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ads-injection.js') }}"></script>
    <script src="{{ url_for('static', filename='js/force-scaling.js') }}"></script>
    <script>
      // Force Scaling Event Handler
      document.addEventListener('forceScalingChanged', function(event) {
          const { action, fromScale, toScale, isForced } = event.detail;
          
          // Add data attribute to body for debugging
          document.body.setAttribute('data-scale', fromScale.toFixed(2));
          
          // Show user feedback for force scaling
          if (action === 'forced' && typeof showToast === 'function') {
              showToast('info', `Zoom level adjusted to 100% (was ${(fromScale * 100).toFixed(0)}%)`);
          }
          
          // Log scaling changes for debugging
          console.log('Force Scaling Event:', {
              action: action,
              fromScale: fromScale,
              toScale: toScale,
              isForced: isForced
          });
      });
      
      // Mobile categories toggle functionality
      document.addEventListener('DOMContentLoaded', function() {
        const categoriesToggle = document.getElementById('mobile-categories-toggle');
        const categoriesContent = document.getElementById('mobile-categories-content');
        const categoriesChevron = document.getElementById('mobile-categories-chevron');
        
        if (categoriesToggle && categoriesContent && categoriesChevron) {
          categoriesToggle.addEventListener('click', function() {
            const isHidden = categoriesContent.classList.contains('hidden');
            
            if (isHidden) {
              categoriesContent.classList.remove('hidden');
              categoriesChevron.style.transform = 'rotate(180deg)';
            } else {
              categoriesContent.classList.add('hidden');
              categoriesChevron.style.transform = 'rotate(0deg)';
            }
          });
          
          // Close categories when clicking on a category link
          const categoryLinks = categoriesContent.querySelectorAll('a');
          categoryLinks.forEach(link => {
            link.addEventListener('click', function() {
              categoriesContent.classList.add('hidden');
              categoriesChevron.style.transform = 'rotate(0deg)';
            });
          });
        }
      });
      
      // Navbar search clear buttons
      (function(){
        function bindSearch(inputId, clearId){
          var input = document.getElementById(inputId);
          var clear = document.getElementById(clearId);
          if(!input || !clear) return;
          function toggle(){ clear.classList.toggle('hidden', !input.value); }
          input.addEventListener('input', toggle);
          clear.addEventListener('click', function(){ input.value=''; input.focus(); toggle(); });
          toggle();
        }
        try {
          bindSearch('navbar-search-input','navbar-search-clear');
          bindSearch('mobile-navbar-search-input','mobile-navbar-search-clear');
        } catch(e) {}
      })();
    </script>
    <script>
      // UI-only feature flags (comments/ratings) applied globally
      (function(){
        try {
          // Prefer server-side persisted flags if present
          const serverEnableComments = JSON.parse('{{ (brand_info.enable_comments if brand_info else True) | tojson }}');
          const serverEnableRatings = JSON.parse('{{ (brand_info.enable_ratings if brand_info else True) | tojson }}');
          const serverEnableAds = JSON.parse('{{ (brand_info.enable_ads if brand_info else True) | tojson }}');
          const serverEnableCampaigns = JSON.parse('{{ (brand_info.enable_campaigns if brand_info else True) | tojson }}');
          const lsComments = localStorage.getItem('ui_enable_comments');
          const lsRatings = localStorage.getItem('ui_enable_ratings');
          const lsAds = localStorage.getItem('ui_enable_ads');
          const lsCampaigns = localStorage.getItem('ui_enable_campaigns');
          const enableComments = lsComments === null ? serverEnableComments : (lsComments === 'true');
          const enableRatings = lsRatings === null ? serverEnableRatings : (lsRatings === 'true');
          const enableAds = lsAds === null ? serverEnableAds : (lsAds === 'true');
          const enableCampaigns = lsCampaigns === null ? serverEnableCampaigns : (lsCampaigns === 'true');

          // Expose flags for other scripts to check before init
          window.__UI_FLAGS__ = {
            enableComments: enableComments,
            enableRatings: enableRatings,
            enableAds: enableAds,
            enableCampaigns: enableCampaigns
          };

          // Add CSS to hide components when disabled (defensive)
          const style = document.createElement('style');
          style.id = 'ui-flags-style';
          style.textContent = `
            ${enableComments ? '' : '[data-content-type] .comments-container, [data-content-type] #inline-comment-form, [data-content-type] #add-comment-btn { display: none !important; }'}
            ${enableRatings ? '' : '[data-rating-instance], .star-rating-container, .rating-display { display: none !important; }'}
            ${enableAds && enableCampaigns ? '' : '.ad-placement-area, .internal-ad, [data-ad], [data-ads], .ad-placement-container { display: none !important; }'}
          `;
          document.head.appendChild(style);
        } catch (e) {
          // ignore
        }
      })();
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
